<html>
	<head>
		<title> Game </title>
		<script type="text/javascript" src="seedrandom.min.js"></script>
	</head>
	
	<body style="background-color:silver">
		<canvas id="gameCanvas" width="500" height="500"> </canvas>
	</body>
	
	<script>
		
		var canvas = document.getElementById("gameCanvas");
		var ctx = canvas.getContext("2d");
		Math.seedrandom("gol spo");
		var und = undefined;
		
		function setUpCanvas(){ctx.translate(canvas.width/2,canvas.height/2);
		ctx.beginPath();
		ctx.arc(0, 0, 250, 0, Math.PI*2, true); 
		ctx.closePath();
		ctx.fill();
		ctx.globalCompositeOperation = "source-atop";
		}
		
		window.requestAnimFrame = (function(){
          return  window.requestAnimationFrame       || 
                  window.webkitRequestAnimationFrame || 
                  window.mozRequestAnimationFrame    || 
                  window.oRequestAnimationFrame      || 
                  window.msRequestAnimationFrame     || 
                  function(/* function */ callback, /* DOMElement */ element){
                    window.setTimeout(callback, 1000 / 60);
                  };
				})();	
		
		
		
		setUpCanvas();
		ctx.fillStyle = "red";
		ctx.fillRect(-5,-5,10,10);
		ctx.strokeStyle = "red";
		
		var rot = 0;
		var invPI = 1/Math.PI;
		
		function Player(){
			this.r=0;        // for player's Rotation
			this.s=0.01;    // for player's rotation Speed
			this.c="orange"; // for player's Color
			this.bc="green"; // for Beam Color
		}
		
		Player.prototype.update=function(){
			this.r%=2;
			this.r+=this.s;
		}
		
		Player.prototype.draw=function(){
			ctx.save();
			
			ctx.strokeStyle = this.bc;
			ctx.beginPath();
			ctx.moveTo(0,0);
			ctx.lineTo(Math.sin(Math.PI*this.r)*250,Math.cos(Math.PI*this.r)*250);
			ctx.stroke();
			
			ctx.restore();
		}
		
		Player.prototype.changeDir=function(){
			this.s*=-1;
		}
		
		function StraightWalker(x,y,s,r,rs,rr){
			this.x = x;
			this.y = y;
			this.r=(r!=und)?r:0;
			this.s=(s!=und)?s:1;     // Speed
			this.rs =(rs!=und)?rs:0.1; // Rotation Speed 
			this.rr =(rr!=und)?rr:0.1; // Rotation Randomness // + or -
		}
		StraightWalker.prototype.update=function(){
			var dr = ((Math.atan2(this.x,this.y)/Math.PI)-1)%2;
			var acw = (dr-this.r+2)%2;
			var cw = (this.r-dr+2)%2;
			this.r = ((acw<cw)?this.r+Math.min(acw,this.rs):this.r-Math.min(cw,this.rs))+this.rr-Math.random2()*this.rr*2;
			this.x+=Math.sin(Math.PI*this.r)*this.s;
			this.y+=Math.cos(Math.PI*this.r)*this.s;
		}
		StraightWalker.prototype.draw = function(){
			ctx.save();
			ctx.translate(this.x,this.y);
			ctx.rotate(Math.PI*(1-this.r))
			
			ctx.fillRect(-5,-5,10,10);
			
			ctx.restore();
		}
		
		var player = new Player(); 
		var enemies =[];
		 for(var i=0,n=50;i<n;i++){
		 enemies[i] = new StraightWalker(Math.sin(Math.PI*i/n*2)*200,Math.cos(Math.PI*i/n*2)*200); 
		 
		 }
		
		enemies.update=function(){
			for(var i=0;i<enemies.length;i++){
				enemies[i].update();
			}
		}
		enemies.draw=function(){
			for(var i=0;i<enemies.length;i++){
				enemies[i].draw();
			}
		}
		
		function updateAll(){
			player.update();
			enemies.update();
		}
		
		function drawAll() {
			ctx.save();
			ctx.fillStyle="black";
			ctx.fillRect(-250,-250,500,500);
			ctx.restore();
			player.draw();
			enemies.draw();
			requestAnimFrame(drawAll);
		}
		
		
		setInterval(updateAll,50);
		drawAll();
		
	</script>
	
</html>
